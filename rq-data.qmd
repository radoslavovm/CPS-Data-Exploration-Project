---
title: "Data Science I Final Project: RQ and Data"
author: "Ayaka"
format: pdf
---

# Which factors best explain variation in receiving SNAP benefits in California vs Texas


```{r data}
library(tidyr)
library(tidycensus)
library(dplyr)
library(purrr)
library(here)
library(tidyverse)
library(psych)
library(ggplot2)
library(cluster)
library(GGally)
library(factoextra)

```

# Data

```{r}
both <- get_acs(geography = "county", 
                state = c("CA", "TX"),
                variables = c("B01001_001", "B07009_013", "B16001_002", "B17001_002", "C22001_002", 
                              "B23008_001", "C24070_002", "B07013_016", "B08006_008", "B25003_002"), 
                year = 2024,
                survey = "acs1") 
pop <- both %>%
  filter(variable == "B01001_001") %>%
  select(GEOID, population = estimate)

joined <- both %>%
  left_join(pop, by = "GEOID")

both <- joined %>%
  mutate(normalized_estimate = estimate / population)

both <- both %>% 
  select(GEOID, NAME, variable, population, normalized_estimate) %>%
  pivot_wider(
    names_from = variable,
    values_from = normalized_estimate
  )


```

# EDA

```{r}
sum(is.na(both))
both <- na.omit(both)
sum(is.na(both))
```

# Clustering

```{r}
both_num <- both %>%
  dplyr::select(-c(GEOID, NAME))

Xsc <- scale(both_num)

set.seed(100)

m <- c( "average", "single", "complete", "ward")
names(m) <- c( "average", "single", "complete", "ward")
ac <- function(x) {
  agnes(Xsc, method = x)$ac
  }
purrr::map_dbl(m, ac)

distance <- dist(Xsc, method = "euclidean")
hc_complete <- hclust(distance, method = 'ward.D2')
plot(hc_complete)

plot <- fviz_dend(hc_complete, k = 2)
plot +
  theme_minimal() +
  labs(title = "Dendrogram based on Hierarchical Clustering")

sub_grp <- cutree(hc_complete, 2)


```
